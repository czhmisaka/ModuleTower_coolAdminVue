import{v as $}from"./@vue.runtime-dom-592c53ed.js";import{Z as A}from"./@element-plus.icons-vue-c499527b.js";import"./index-1e0489aa.js";import"./store-acb3382e.js";import{u as H}from"./index-eba40255.js";import{u as Q}from"./hook-6b6f6a66.js";import{U as W}from"./index-8ca809a2.js";import{a as y,b as Y}from"./element-plus-7426fe99.js";import{d as S,q as ee,E as ae,X as d,$ as te,o as p,c as _,e as s,K as u,a as i,O as E,J as z,N as ne,L as I,F as le,V as oe}from"./@vue.runtime-core-0029b467.js";import{r as V,j as se,u as m}from"./@vue.reactivity-b2e38c7a.js";import{o as ie,O as M}from"./@vue.shared-ccdbf9b9.js";const ce={class:"cl-upload-space-inner__right"},re={class:"cl-upload-space-inner__header"},pe={style:{margin:"0px 10px"}},ue=["onClick"],de={class:"cl-upload-space-inner__file-index"},fe={key:1,class:"cl-upload-space-inner__file-empty"},_e=i("p",null,"将文件拖到此处，或点击按钮上传",-1),me={class:"cl-upload-space-inner__footer"},ve=S({name:"cl-upload-space-inner"}),Be=S({...ve,props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change","confirm"],setup(x,{expose:O,emit:U}){const v=x,j=U,{service:g,browser:b,refs:q,setRefs:G}=H(),{ViewGroup:D}=Q({label:"分类",title:"文件列表",service:g.space.type,onEdit(){return{width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:"名称",prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}]}},onSelect(e){f({classifyId:e.id,page:1})}}),h=V(!1),n=V([]),c=V([]),r=se({page:1,size:20,total:0});function P(){n.value=[]}function T(e){var a,t;g.space.info.add({classifyId:(t=(a=D.value)==null?void 0:a.selected)==null?void 0:t.id,...e}).then(o=>{e.id=o.id}).catch(o=>{y.error(o.message)})}function F(e){c.value.unshift(e)}const w={page:1};async function f(e){var a;Object.assign(w,{type:((a=v.accept)==null?void 0:a.split("/")[0].replace("*",""))||void 0,...r,...e}),w.page==1&&(h.value=!0),await g.space.info.page(w).then(t=>{Object.assign(r,t.pagination),c.value=t.list}),h.value=!1}function L(e){const a=n.value.findIndex(t=>t.id===e.id);a>=0?n.value.splice(a,1):v.limit==1?n.value=[e]:n.value.length<v.limit?n.value.push(e):y.warning(`最多只能选择${v.limit}个文件`)}function B(e){return n.value.findIndex(a=>a.id===e)+1}function N(e){const a=e?[e.id]:n.value.map(t=>t.id);Y.confirm("此操作将删除文件, 是否继续?","提示",{type:"warning"}).then(()=>{y.success("删除成功"),a.forEach(t=>{[c.value,n.value].forEach(o=>{const k=o.findIndex(C=>C.id===t);o.splice(k,1)})}),g.space.info.delete({ids:a}).catch(t=>{y.error(t.message)})}).catch(()=>null)}function R(e){e.preventDefault()}function J(e){e.preventDefault(),e.dataTransfer.files.forEach((a,t)=>{setTimeout(()=>{q.upload.upload(a)},t*10)})}return ee(n,e=>{j("selection-change",e)},{deep:!0}),ae("upload-space",{selection:n,refresh:f,loading:h,list:c}),O({selection:n,open,close,clear:P,refresh:f}),(e,a)=>{const t=d("el-button"),o=d("cl-upload"),k=d("el-icon"),C=d("el-scrollbar"),K=d("el-pagination"),X=d("cl-view-group"),Z=te("loading");return p(),_("div",{class:"cl-upload-space-inner",onDragover:R,onDrop:J},[s(X,{ref_key:"ViewGroup",ref:D},{right:u(()=>[i("div",ce,[i("div",re,[s(t,{onClick:a[0]||(a[0]=l=>f({page:1}))},{default:u(()=>[E("刷新")]),_:1}),i("div",pe,[s(o,{ref:m(G)("upload"),menu:"space",type:"file",multiple:"","show-file-list":!1,limit:9999,accept:x.accept,onSuccess:T,onUpload:F},{default:u(()=>[s(t,{type:"primary"},{default:u(()=>[E("点击上传")]),_:1})]),_:1},8,["accept"])]),x.selectable?ne("",!0):(p(),z(t,{key:0,type:"danger",disabled:n.value.length==0,onClick:a[1]||(a[1]=l=>N())},{default:u(()=>[E("删除选中文件")]),_:1},8,["disabled"]))]),I((p(),z(C,{class:"cl-upload-space-inner__file"},{default:u(()=>[c.value.length>0?(p(),_("div",{key:0,class:ie(["cl-upload-space-inner__file-list",{"is-mini":m(b).isMini}])},[(p(!0),_(le,null,oe(c.value,l=>(p(),_("div",{class:"cl-upload-space-inner__file-item",key:l.preload||l.url,onClick:ge=>L(l)},[s(W,{item:l,list:c.value,onRemove:N},null,8,["item","list"]),I(i("div",de,[i("span",null,M(B(l.id)),1)],512),[[$,B(l.id)]])],8,ue))),128))],2)):(p(),_("div",fe,[s(k,{class:"el-icon--upload"},{default:u(()=>[s(m(A))]),_:1}),_e]))]),_:1})),[[Z,h.value]]),i("div",me,[s(K,{small:!!m(b).isMini,total:r.total,"default-page-size":r.size,"current-page":r.page,"onUpdate:currentPage":a[2]||(a[2]=l=>r.page=l),background:"",layout:"prev, pager, next",onCurrentChange:a[3]||(a[3]=l=>f())},null,8,["small","total","default-page-size","current-page"]),I(i("span",{class:"total"},"共 "+M(r.total)+" 条",513),[[$,!m(b).isMini]])])])]),_:1},512)],32)}}});export{Be as _};
