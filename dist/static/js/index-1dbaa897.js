import{l as ie,v as le}from"./@vue.runtime-dom-592c53ed.js";import{n as I,m as ae,T as ne,B as re,a1 as ce}from"./@element-plus.icons-vue-c499527b.js";import{i as L,a as de,e as ue}from"./index-1e0489aa.js";import{u as pe}from"./index-eba40255.js";import{x as me,n as _e}from"./lodash-es-74a5df03.js";import{a as w,b as fe}from"./element-plus-7426fe99.js";import{d as J,I as ve,A as he,f as ge,X as g,$ as O,o as a,c as h,a as n,G as M,e as c,K as d,N as $,J as p,n as be,L as F,M as ke,F as ye,V as Ce}from"./@vue.runtime-core-0029b467.js";import{j as K,r as E,u as m}from"./@vue.reactivity-b2e38c7a.js";import{o as W,O as z}from"./@vue.shared-ccdbf9b9.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";import"./@vueuse.core-bf8dfe85.js";import"./@vueuse.shared-501e3e4b.js";import"./store-acb3382e.js";import"./chardet-cfd7d38a.js";import"./mitt-b509fb6d.js";import"./axios-f6771985.js";import"./nprogress-5ff42f71.js";import"./pinia-6d4e9d4f.js";import"./monaco-editor-f913c445.js";import"./vue-echarts-8be4a346.js";import"./resize-detector-a5205554.js";import"./echarts-eea5b079.js";import"./tslib-54e39b60.js";import"./zrender-ecf5ed03.js";import"./vue-router-6b15fa8a.js";import"./mockjs-597bdf6e.js";import"./vue-aac48648.js";import"./dayjs-20b85df8.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./async-validator-8a4f889d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-f47942fe.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-4390772d.js";import"./@floating-ui.core-1d013f45.js";import"./@floating-ui.utils-1e4a7d10.js";const we={class:"cl-view-group__wrap"},Me={class:"cl-view-group__left"},$e={class:"scope"},Ee={class:"head"},ze={class:"data"},Be={class:"item"},Se=["infinite-scroll-disabled"],Fe=["onClick","onContextmenu"],Ne={class:"cl-view-group__right"},Ve={class:"head"},je={class:"title"},De={key:0,class:"content"},Le=J({name:"cl-view-group"}),Oe=J({...Le,setup(Te,{expose:P}){ie(e=>({"113ae20a":t.leftWidth}));const{browser:B,onScreenChange:X}=de(),H=ve(),T=L.useForm(),{refs:Q,setRefs:U}=pe(),t=K(Object.assign({label:"组",title:"列表",leftWidth:"300px",data:{},service:{},enableContextMenu:!0,enableRefresh:!0,enableAdd:!0},he("useViewGroup__options"))),A=!!H.left;me(t.service);const N=E(!1),u=E([]),b=E(!0),r=E(),_=K(_e({visible:!!t.tree,props:{label:"name",children:"children",disabled:"disabled",isLeaf:"isLeaf",class:""},defaultExpandedKeys:[]},t.tree));function k(e){b.value=e===void 0?!b.value:e}function y(e){e||(e=u.value[0]),r.value=e,be(()=>{e&&(B.isMini&&k(!1),t.onSelect&&t.onSelect(e))})}function V(e){var s,i;(i=T.value)==null||i.open({title:(e?"编辑":"添加")+t.label,form:{...e},on:{submit(l,{close:f,done:v}){t.service[e?"update":"add"](l).then(()=>{w.success("保存成功"),e?Object.assign(e,l):C(),f()}).catch(j=>{w.error(j.message),v()})}},...(s=t.onEdit)==null?void 0:s.call(t,e)},[L.setFocus()])}function R(e){fe.confirm("此操作将会删除选择的数据，是否继续？","提示",{type:"warning"}).then(()=>{t.service.delete({ids:[e.id]}).then(async()=>{var s;w.success("删除成功"),await C(),((s=r.value)==null?void 0:s.id)==e.id&&y()}).catch(s=>{w.error(s.message)})}).catch(()=>null)}const S={order:"createTime",sort:"asc",page:1,size:20},q=E(!1);async function C(e){if(A)return!1;Object.assign(S,e),N.value=!0;const s={...S,...t.data};let i;_.visible?i=t.service.list(s).then(l=>{u.value=ue(l)}):i=t.service.page(s).then(l=>{var v;const f=((v=t.onData)==null?void 0:v.call(t,l.list))||l.list;S.page==1?u.value=f:u.value.push(...f),q.value=l.pagination.total<=u.value.length}),await i.then(()=>{const l=r.value||u.value[0];l&&(_.visible&&Q.tree.getNode(l).expand(),y(l))}).catch(l=>{w.error(l.message)}),N.value=!1}function Y(){C({page:S.page+1})}function Z(e,s){if(!t.enableContextMenu)return!1;L.ContextMenu.open(e,{hover:{target:"item"},list:[{label:"编辑",hidden:!t.service._permission.update,callback(i){i(),V(s)}},{label:"删除",hidden:!t.service._permission.delete,callback(i){i(),R(s)}}],...t.onContextMenu&&t.onContextMenu(s)})}return X(()=>{k(!B.isMini)}),ge(()=>{C()}),P({selected:r,isExpand:b,expand:k,select:y,browser:B,edit:V,remove:R}),(e,s)=>{const i=g("el-icon"),l=g("el-tooltip"),f=g("el-tree"),v=g("el-empty"),j=g("el-scrollbar"),ee=g("cl-form"),te=O("permission"),se=O("infinite-scroll"),oe=O("loading");return a(),h("div",{class:W(["cl-view-group",[b.value?"is-expand":"is-collapse"]])},[n("div",we,[n("div",Me,[M(e.$slots,"left",{},()=>[n("div",$e,[n("div",Ee,[n("span",null,z(t.label),1),t.enableRefresh?(a(),p(l,{key:0,content:"刷新"},{default:d(()=>[c(i,{onClick:s[0]||(s[0]=o=>C())},{default:d(()=>[c(m(ne))]),_:1})]),_:1})):$("",!0),t.enableAdd?(a(),p(l,{key:1,content:"添加"},{default:d(()=>[F((a(),p(i,{onClick:s[1]||(s[1]=o=>V())},{default:d(()=>[c(m(re))]),_:1})),[[te,t.service.permission.add]])]),_:1})):$("",!0)]),F((a(),h("div",ze,[c(j,null,{default:d(()=>[_.visible?(a(),p(f,{key:0,class:"tree","highlight-current":"","auto-expand-parent":"","expand-on-click-node":!1,ref:m(U)("tree"),lazy:_.lazy,data:u.value,props:_.props,load:_.onLoad,onNodeClick:y},{default:d(({data:o})=>[n("div",Be,[o.icon?(a(),p(ke(o.icon),{key:0})):$("",!0),n("span",null,z(o[_.props.label]),1)])]),_:1},8,["lazy","data","props","load"])):F((a(),h("ul",{key:1,class:"list","infinite-scroll-immediate":!1,"infinite-scroll-disabled":q.value},[(a(!0),h(ye,null,Ce(u.value,(o,D)=>(a(),h("li",{key:D,onClick:x=>y(o),onContextmenu:x=>{Z(x,o)}},[M(e.$slots,"item",{item:o,selected:r.value,index:D},()=>{var x,G;return[n("div",{class:W(["item",{"is-active":((x=r.value)==null?void 0:x.id)==o.id}])},[M(e.$slots,"item-name",{item:o,selected:r.value,index:D},()=>[n("span",null,z(o.name),1)],!0),F(c(i,{class:"arrow-right"},{default:d(()=>[c(m(ce))]),_:2},1536),[[le,((G=r.value)==null?void 0:G.id)==o.id]])],2)]},!0)],40,Fe))),128)),u.value.length==0?(a(),p(v,{key:0,"image-size":80})):$("",!0)],8,Se)),[[se,Y]])]),_:3})])),[[oe,N.value]])])],!0),m(B).isMini?(a(),h("div",{key:0,class:"collapse-btn",onClick:s[2]||(s[2]=o=>k(!1))},[c(i,null,{default:d(()=>[c(m(I))]),_:1})])):$("",!0)]),n("div",Ne,[n("div",Ve,[n("div",{class:"icon",onClick:s[3]||(s[3]=o=>k())},[b.value?(a(),p(i,{key:0},{default:d(()=>[c(m(ae))]),_:1})):(a(),p(i,{key:1},{default:d(()=>[c(m(I))]),_:1}))]),M(e.$slots,"title",{selected:r.value},()=>{var o;return[n("span",je,z(t.title)+"（"+z(((o=r.value)==null?void 0:o.name)||"未选择")+"） ",1)]},!0)]),r.value?(a(),h("div",De,[M(e.$slots,"right",{},void 0,!0)])):(a(),p(v,{key:1,"image-size":80}))])]),c(ee,{ref_key:"Form",ref:T},null,512)],2)}}});const Ct=xe(Oe,[["__scopeId","data-v-0a516e49"]]);export{Ct as default};
