import{v as q,w as x}from"./@vue.runtime-dom-592c53ed.js";import{W as K,X as F,u as J,P as X}from"./@element-plus.icons-vue-c499527b.js";import{m as G,l as H,n as R,u as Q,i as Y}from"./index-1e0489aa.js";import{u as S}from"./index-eba40255.js";import{B as D,D as Z}from"./lodash-es-74a5df03.js";import{a as ee}from"./@vueuse.core-bf8dfe85.js";import"./store-acb3382e.js";import{W as j}from"./ts-wps-c1dd0e62.js";import{a as N}from"./element-plus-7426fe99.js";import{d as k,X as b,o as i,J as g,K as C,a as m,c as v,N as $,e as y,t as B,q as te,f as oe,F as V,L as se,a1 as ie}from"./@vue.runtime-core-0029b467.js";import{r as z,j as T,u as f,t as ne}from"./@vue.reactivity-b2e38c7a.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import{O as I,o as E,p as ae}from"./@vue.shared-ccdbf9b9.js";const{options:le}=G.get("upload"),M=le.rules||[];function re(e){return H(e.substring(e.indexOf("_")+1))}function ce(e){return M.find(t=>t.exts.find(u=>u==R(e||"").toLocaleLowerCase()))||D(M)}function ue(e){return M.find(r=>r.type==e)||D(M)}function de(e){return ce(e).type}function qe(e){return e.map(r=>r.url.replace(/,/g,encodeURIComponent(",")))}function Ke(...e){if(e.length===0)return"";const r=e[0];let t=!1;r.startsWith("http")&&(t=!0);const u=e.map(c=>c.replace(/(^\/+|\/+$)/g,""));return u.join("/")}const me=m("div",{class:"file-wps"},null,-1),fe=k({name:"undefined"}),pe=k({...fe,setup(e,{expose:r}){const{service:t}=S(),{user:u}=Q(),c=z(""),a=z(!1);async function h(){c.value||await t.space.info.getConfig().then(l=>{c.value=l.appId})}let d=null;async function s(l){if(a.value=!0,await h(),!c.value)return N.error("请先配置WPS的应用ID");d=j.init({officeType:j.OfficeType[l.officeType],appId:c.value,fileId:l.fileId,mount:document.querySelector(".file-wps"),fileToken:{token:u.token,timeout:10*60*1e3}}),d.ready()}function p(){d.destroy()}return r({open:s}),(l,w)=>{const _=b("cl-dialog");return i(),g(_,{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=o=>a.value=o),width:"80%",onClosed:p},{default:C(()=>[me]),_:1},8,["modelValue"])}}});const _e={class:"file-viewer"},ve=k({name:"file-viewer"}),ye=k({...ve,setup(e,{expose:r}){let t;(s=>{s.word="Writer",s.excel="Spreadsheet",s.ppt="Presentation",s.pdf="Pdf"})(t||(t={}));const{refs:u,setRefs:c}=S(),a=T({visible:!1,url:""});function h(s){var p;if(s!=null&&s.type){const l=s.url||"",w=de(l);if(w=="image")return a.visible=!0,a.url=l,!0;if(Z(t,w))return(p=u.wps)==null?void 0:p.open(Object.assign(ne(s),{officeType:t[s.type]}));window.open(s.url)}}function d(){a.visible=!1}return r({open:h}),(s,p)=>{const l=b("el-image-viewer");return i(),v("div",_e,[a.visible?(i(),g(l,{key:0,"url-list":[a.url],infinite:"",teleported:"",onClose:d},null,8,["url-list"])):$("",!0),y(pe,{ref:f(c)("wps")},null,512)])}}});const ge=U(ye,[["__scopeId","data-v-b5137cd3"]]),we={class:"cl-upload-item__wrap"},be=["onContextmenu"],ke=["src"],he={class:"cl-upload-item__icon"},xe={class:"cl-upload-item__name"},Ce=["src"],Pe={class:"cl-upload-item__progress-bar"},Ie={class:"cl-upload-item__progress-value"},$e={key:4,class:"cl-upload-item__actions"},Me=k({name:"cl-upload-item"}),Se=k({...Me,props:{item:{type:Object,required:!0},list:{type:Array,default:()=>[]},disabled:Boolean},emits:["remove"],setup(e,{emit:r}){const t=e,u=r,{refs:c,setRefs:a}=S(),{copy:h}=ee(),d=B(()=>t.item.url||""),s=B(()=>({color:ue(t.item.type).color,name:R(t.item.name||d.value)}));function p(){u("remove",t.item)}function l(){c.viewer.open(t.item)}function w(o){Y.ContextMenu.open(o,{hover:{target:"cl-upload-item__wrap"},list:[{label:"预览",callback(n){l(),n()}},{label:"复制链接",callback(n){t.item.url&&(h(t.item.url),N.success("复制成功")),n()}},{label:"删除",callback(n){p(),n()}}]})}const _=T({isMedia:["video","audio"].includes(t.item.type),play(){t.list.forEach(o=>{o.isPlay=o.uid?t.item.uid==o.uid:t.item.id==o.id})},pause(){t.item.isPlay=!1},create(){if(!_.isMedia)return!1;let o;te(()=>t.item.isPlay,n=>{o||(o=c[t.item.type],o==null||o.addEventListener("ended",()=>{_.pause()})),n?o==null||o.play():o==null||o.pause()})}});return oe(()=>{_.create()}),(o,n)=>{const A=b("el-image"),L=b("cl-svg"),W=b("el-progress"),P=b("el-icon");return i(),v("div",we,[(i(),g(ie,null,[m("div",{class:E(["cl-upload-item",[{"is-play":e.item.isPlay}]]),onContextmenu:x(w,["stop","prevent"])},[e.item.type==="image"&&!e.item.error?(i(),g(A,{key:0,class:"cl-upload-item__image-cover",fit:"contain",src:e.item.preload||d.value,lazy:"",onError:n[0]||(n[0]=O=>e.item.error="加载失败")},null,8,["src"])):e.item.type==="video"?(i(),v("video",{ref:f(a)("video"),src:e.item.url,key:e.item.url},null,8,ke)):(i(),v(V,{key:2},[m("div",he,[y(L,{name:e.item.type},null,8,["name"])]),m("div",xe,[m("span",null,I(f(re)(e.item.name||d.value)),1),se(m("span",{class:"error"},I(e.item.error),513),[[q,e.item.error]])])],64)),e.item.type==="audio"?(i(),v("audio",{key:3,controls:"",ref:f(a)("audio")},[(i(),v("source",{src:e.item.url,type:"audio/mpeg",key:e.item.url},null,8,Ce))],512)):$("",!0),m("div",{class:E(["cl-upload-item__progress",{"is-show":e.item.progress>=0&&e.item.progress<100,"is-hide":e.item.progress==100}])},[m("div",Pe,[y(W,{percentage:e.item.progress,"show-text":!1},null,8,["percentage"])]),m("span",Ie,I(e.item.progress),1)],2),m("span",{class:"cl-upload-item__tag",style:ae({backgroundColor:s.value.color})},I(s.value.name),5),d.value?(i(),v("div",$e,[_.isMedia?(i(),v(V,{key:0},[e.item.isPlay?(i(),g(P,{key:0,onClick:n[1]||(n[1]=x(O=>_.pause(),["stop"]))},{default:C(()=>[y(f(K))]),_:1})):(i(),g(P,{key:1,onClick:n[2]||(n[2]=x(O=>_.play(),["stop"]))},{default:C(()=>[y(f(F))]),_:1}))],64)):(i(),g(P,{key:1,onClick:x(l,["stop"])},{default:C(()=>[y(f(J))]),_:1},8,["onClick"])),e.disabled?$("",!0):(i(),g(P,{key:2,onClick:x(p,["stop"])},{default:C(()=>[y(f(X))]),_:1},8,["onClick"]))])):$("",!0)],42,be)],1024)),y(ge,{ref:f(a)("viewer")},null,512)])}}});const Oe=U(Se,[["__scopeId","data-v-b89d4831"]]),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{Oe as U,de as a,qe as g,Fe as i,Ke as p};
